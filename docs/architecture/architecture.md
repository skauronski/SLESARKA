# Микросервисная архитектура сайта онлайн-магазина Slesarka.by

## Описание магазина

1. У магазина должен быть свой сайт, оформленный в цветах брендбука.
2. Пользователь может видеть товары, сгруппированные по разделам (бакалея, молочные продукты, мясные продукты и прочее).
3. Пользователь может видеть весь перечень товаров, участвующих в акции на текущий период.
4. Пользователь может добавлять товары в корзину.
5. Пользователь может писать отзывы на товары, которые он ранее приобретал.
6. Пользователь может видеть сумму стоимости товаров, которые сложил в корзину с учётом скидки.
7. Пользователь может ввести номер своей дисконтной карты при оформлении заказа, и стоимость заказа будет автоматически пересчитана.
8. Пользователь может указать адрес доставки или выбрать самовывоз при выборе способа доставки.
9. Пользователь видит либо режим работы пункта выдачи, либо диапазоны времени, когда может приехать курьер с заказом.

### Дополнительные фичи
1. Пользователь может оплатить товар через ЕРИП.
2. Пользователь может оплатить товар через Интернет-банк.

---

## Обоснование выбора архитектуры

### Преимущества микросервисной архитектуры

1. **Высокая масштабируемость**:
   - Приложение разбито на небольшие независимые компоненты (микросервисы), каждый из которых выполняет конкретную функцию.
   - Горизонтальное масштабирование отдельных сервисов (например, сервис корзины или оплаты) позволяет гибко управлять ресурсами.

2. **Высокая производительность**:
   - Добавление серверов для микросервисов позволяет распределять нагрузку и управлять трафиком, особенно в пиковые периоды (акции, праздники).

3. **Отказоустойчивость**:
   - Отказ одного сервиса не приводит к остановке системы в целом. Например, если сервис отзывов недоступен, это не влияет на возможность просмотра товаров или оформления заказов.

4. **Высокая скорость разработки**:
   - Разработчики могут работать над отдельными сервисами независимо друг от друга.
   - Быстрое внедрение нового функционала.

5. **Отсутствие ограничений в стеке технологий**:
   - Микросервисы могут использовать разные технологии и языки программирования.

6. **Удобство интеграции с внешними системами**:
   - Легкая интеграция с внешними API (например, платежными системами, службами доставки).

7. **Улучшенная производительность**:
   - Распределение нагрузки между несколькими серверами повышает общую производительность системы.

---

## Основные микросервисы

### 1. Сервис каталога товаров (Product Catalog Service)
- Отвечает за хранение и отображение информации о товарах.
- Группирует товары по категориям (бакалея, молочные продукты, мясные продукты и т.д.).
- Предоставляет API для поиска товаров, фильтрации и получения деталей товара.
- Интегрируется с сервисом акций для отображения товаров, участвующих в акциях.

### 2. Сервис корзины (Shopping Cart Service)
- Управляет добавлением, удалением и изменением товаров в корзине пользователя.
- Рассчитывает общую стоимость товаров с учётом скидок и акций.
- Интегрируется с сервисом скидок и дисконтных карт для пересчёта стоимости.

### 3. Сервис ценообразования и склада (Pricing & Inventory Service)
- Рассчитывает окончательную стоимость товара для реализации:
  - Цена из накладной + НДС (20% или 10%) + торговая надбавка.
  - Учитывает ограничения по законодательству (например, фиксированная торговая надбавка на овощи и фрукты).
- Управляет остатками товаров на складе.
- Обрабатывает переоценку товаров при изменении стоимости.
- Интегрируется с сервисом каталога для отображения актуальных цен.

### 4. Сервис акций и скидок (Promotion Service)
- Управляет акциями, скидками и специальными предложениями.
- Предоставляет информацию о текущих акциях для отображения на сайте.
- Интегрируется с сервисом корзины для применения скидок.

### 5. Сервис отзывов (Review Service)
- Позволяет пользователям оставлять отзывы на товары, которые они приобрели.
- Хранит и отображает отзывы на страницах товаров.
- Интегрируется с сервисом заказов для проверки, что пользователь действительно покупал товар.

### 6. Сервис заказов (Order Service)
- Управляет процессом оформления заказов.
- Обрабатывает выбор способа доставки (самовывоз или курьерская доставка).
- Интегрируется с сервисом доставки для расчёта времени доставки.

### 7. Сервис доставки (Delivery Service)
- Управляет информацией о пунктах выдачи и времени работы курьеров.
- Предоставляет API для получения доступных временных диапазонов доставки.
- Интегрируется с сервисом заказов для обновления статуса доставки.

### 8. Сервис оплаты (Payment Service)
- Обрабатывает платежи через различные системы (ЕРИП, Интернет-банк и другие).
- Интегрируется с сервисом заказов для подтверждения оплаты.
- Поддерживает возвраты и обработку ошибок при оплате.

### 9. Сервис пользователей (User Service)
- Управляет учётными записями пользователей.
- Обрабатывает авторизацию и аутентификацию.
- Хранит информацию о дисконтных картах и их привязке к пользователям.

### 10. Сервис авторизации (Auth Service)
- Проверяет права доступа пользователя к определённым ресурсам (например, доступ к админ-панели).
- Генерация и валидация токенов (JWT).

---

## Сценарии пользователей в системе

### Пользователь просматривает товары
1. Пользователь заходит на сайт, выбирает категорию "Молочные продукты".
2. Сервис каталога товаров отображает список товаров.
3. Пользователь видит товары, участвующие в акции, благодаря интеграции с Сервисом акций.

### Пользователь добавляет товары в корзину
1. Пользователь выбирает товар и нажимает "Добавить в корзину".
2. Сервис корзины добавляет товар и рассчитывает общую стоимость с учётом скидок, запрашивая данные у Сервиса акций.

### Пользователь оформляет заказ
1. Пользователь переходит к оформлению заказа, выбирает способ доставки (самовывоз).
2. Сервис заказов взаимодействует с Сервисом доставки для отображения времени работы пункта выдачи.
3. Пользователь вводит номер дисконтной карты, и Сервис заказов запрашивает скидку у Сервиса пользователей.

### Пользователь оплачивает заказ
1. Пользователь выбирает оплату через Интернет-банк.
2. Сервис оплаты обрабатывает платеж и уведомляет Сервис заказов об успешной оплате.
3. Пользователь получает подтверждение заказа.

### Администратор добавляет новую акцию
1. Администратор через админ-панель добавляет новую акцию в Сервис акций.
2. Сервис акций обновляет информацию, и товары с акцией отображаются на сайте.

### Курьер проверяет заказы на доставку
1. Курьер заходит в систему через мобильное приложение, интегрированное с Сервисом доставки.
2. Сервис доставки отображает список заказов, которые нужно доставить в текущий день.

---

## Доработки по замечаниям

1. **Расчёт стоимости товара**:
   - Добавлен **Сервис ценообразования и склада (Pricing & Inventory Service)**, который рассчитывает окончательную стоимость товара с учётом НДС и торговой надбавки.
   - Этот сервис также управляет остатками товаров и переоценкой при изменении стоимости.

2. **Сервис дисконтных карт**:
   - Интегрирован в **Сервис пользователей (User Service)**, так как наличие дисконтной карты — это характеристика пользователя.

3. **Сервис авторизации**:
   - Добавлен **Сервис авторизации (Auth Service)** для управления правами доступа и генерации токенов.
